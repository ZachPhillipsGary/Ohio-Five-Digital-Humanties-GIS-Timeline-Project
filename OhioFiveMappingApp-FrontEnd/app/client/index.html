<!doctype html>
<html lang="en">
<head>
    <script src="http://cdn.rightjs.org/right-2.3.0.js"></script>
    <script src="./js/resize.js"></script>
    <script src="./js/arrayincludes.js"></script>
    <link rel="stylesheet" href="./bower_components/angular-multi-select/isteven-multi-select.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.3.15/angular-cookies.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.6.0/css/ol.css" type="text/css">
    <link rel="stylesheet" href="./css/style.css" type="text/css">
    <link rel="stylesheet" href="./css/bootstrap.css" type="text/css">
    <script src="http://openlayers.org/en/v3.6.0/build/ol.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.2.0/vis.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.2.0/vis.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="./bower_components/openlayers3/build/ol.js"></script>
    <script src="./bower_components/angular-sanitize/angular-sanitize.min.js"></script>
    <script src="./dist/angular-openlayers-directive.js"></script>
    <script src="./bower_components/angular-multi-select/isteven-multi-select.js"></script>
    <script src="./bower_components/moment/min/moment.min.js"></script>
    <script src="./bower_components/vis/dist/vis.min.js"></script>
    <script src="./bower_components/angular-visjs/angular-vis.js"></script>
    <script src='./bower_components/angular-route/angular-route.min.js'></script>
    <link rel="stylesheet" href="./bower_components/openlayers3/build/ol.css" />
    <link rel="stylesheet" href="../bower_components/openlayers3/build/ol.css" />
    <link rel="stylesheet" href="../dist/angular-openlayers-directive.css" />
    <script src='./js/app.js'></script>
    <script src='./js/client.js'></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/textAngular/1.4.3/dist/textAngular.min.js"></script>
    <script type="text/javascript" src="./js/auth.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=checkAuth"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>

<body ng-app="mapApp">
    <div id='mainCtrl' ng-controller="mainCtrl">
        <!-- Alert Box-->
        <div ng-show="alertBox.view" ng-click="alertBox.view=false" class="alert alert-danger">
            {{alertBox.msg}} <strong><button class="btn">X</button></strong>
        </div>
        <!-- Add Marker Form-->
        <div id="markerMaker" ng-show="addMarker.create" class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Add Data</h3>

            </div>
            <div class="panel-body">
              <div ng-show="!addMarker.select==true && addMarker.authorize==true" class="list-group">
  <a ng-click="addMarker.select=true;" class="list-group-item">
    <h4 class="list-group-item-heading">Add Marker</h4>
    <p class="list-group-item-text">Markers are used to repersent single points of data on the map.</p>
  </a>
  <a ng-click="addMarker.select=true;" class="list-group-item">
    <h4 class="list-group-item-heading">Add Layer</h4>
    <p class="list-group-item-text">Layers allow you to incliude KML, geoJSON or data from Open Street Map on your map</p>
  </a>
</div>
<div id="addMarker_auth" ng-show="!addMarker.authorize==true">
  <a ng-click="authorize.showField=true" href="{{authorize.url}}" target="_blank" class="btn btn-primary btn-lg"><i class="fa fa-google"></i> Sign in with Google</a>
</div>
<div ng-show="!addMarker.showField==true">
  Insert the authentication code from Google here: <input type="input" style="width: 300px;" ng-model="authorize.key" /><button ng-click="authorizeUser()" class="btn btn-primary btn-xs">Next</button>
  {{authorize.msg}}
</div>
    <div ng-show="addMarker.authorize==true">
              <div ng-show="addMarker.geoCode==false && addMarker.latlon==false && addMarker.select==true">
                <button ng-click="addMarker.geoCode=true;" class="btn btn-info">Get position by address</button> or
                <button ng-click="addMarker.latlon=true;" class="btn btn-info">Get position from map</button>
              </div>
                <div id="geoCode" ng-show="addMarker.geoCode"> Address
                    <input placeholder="1189 Beall Avenue, Wooster, OH 44691" type="input" style="width: 300px;" ng-model="addMarker.address" />
                    <br><a href="#">Geocoding Key</a>
                    <input type="input" style="width: 300px;" ng-model="addMarker.geoCodekey" />
                    <button class="btn btn-pimary btn-xs" ng-click="geoCode()">get coordinates from address</button>
                    <hr> Results:
                    <ul>
                        <li ng-repeat="item in addMarker.geoCoderesults">
                            <button ng-click="selectGeoCodeItem(item)" class="btn btn-link">{{item.formatted}}</button>
                        </li>
                    </ul>
                    <hr>
                </div>
                <div id='latlng' ng-show="addMarker.latlon">
                  Message: <input type="input" style="width: 300px;" ng-model="addMarker.label.message" />
                    <p>Lat:
                        <input type="number" ng-model="addMarker.lat" />, Lon:
                        <input type="number" ng-model="addMarker.lon" />
                    </p>
                    <input type="checkbox" ng-model="addMarker.label.show" /> Label show
                    <input type="checkbox" ng-model="addMarker.label.showOnMouseOver" /> Label show on marker mouse over
                    <p>Start:
                        <input type="date" placeholder="yyyy-MM-ddTHH:mm:ss" ng-model="addMarker.startDate" required />, End:
                        <input placeholder="yyyy-MM-dd" required type="date" ng-model="addMarker.endDate" />
                    </p>
                    Tags:
                    <ul>
                        <li ng-repeat="tag in addMarker.tags">{{tag}}</li>
                    </ul>
                    <input id="newTag" ng-model="addMarker.newTag" type="input" style="width: 100px;" />
                    <button ng-click="addTag()" class="btn btn-primary btn-xs">Add</button>
                </div>

                <hr>
                <button ng-click="saveMarker()" class="btn btn-success">Save</button> <a href="#" ng-click="addMarker.create=false;addMarker.geoCode=false;addMarker.latlon=false;" class="btn btn-danger">Quit</a>
                <pre ng-show="addMarker.viewSource" ng-bind="addMarker | json"></pre> </div>
        </div>
      </div>
        <!-- Control Panel Modal -->
        <div id="adminCtrl" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">Admin</h4>
                    </div>
                    <div class="modal-body">
                        <div id="authorize-div" style=" display: none">
                            <div class="alert alert-dismissible alert-info">
                                <button type="button" class="close" data-dismiss="alert">×</button>
                                <h4>Ready to create your own Timeline?</h4>
                                <p>Simply login to <a href="https://drive.google.com" class="alert-link">Google Drive</a> and select a <a class="alert-link" href="https://docs.google.com/spreadsheets/d/1j9Z3bmaoCNd3DC1Vju2xCLsyYJW_SPiSOWBrYgt0F6o/edit?usp=sharing">correctly formatted spreadsheet</a> from the dropdown below to begin!</p>
                            </div>
                            <!--Button for the user to click to initiate auth sequence -->
                            <button id="authorize-button" onclick="handleAuthClick(event)" class="btn btn-primary btn-lg"><i class="fa fa-google"></i> Sign in with Google</button>
                        </div>
                        <div id="loaderAnimation" align="center"><i class="fa fa-spinner fa-pulse fa-3x"></i>
                            <br>Loading</div>
                    </div>
                    <div id="adminCtrlbox" style="display:none;">
                        <h4>Load Spreadsheet</h4>
                        <span>Select a Spreadsheet from your Google Drive account to load into onto the map with the drop down below.</span>
                        <br/>
                        <!-- data selector -->
                        <isteven-multi-select selection-mode="single" input-model="googleData" on-item-click="addLayer( data )" output-model="selectedData" button-label="fileName" item-label="fileName" tick-property="use" data-toggle="dropdown">
                        </isteven-multi-select>
                        <h4>Create Spreadsheet</h4> To save a copy of the timemap template to your Google Drive, simply cick the save button below and select a location for the file. Next, open the file using Google Drive and <a href="https://support.google.com/docs/answer/37579?hl=en">publish it to the internet</a>. Once you've published the sheet, you'll be able to load it using the drop down menu above.

                        <div class="paddingZone">Map Name:
                            <input type="text" ng-model="newMapName" />

                            <div class="g-savetodrive" data-src="./templates/model.csv" data-filename="newMapName" data-sitename="OhioFiveTimeMapApp">
                            </div>
                        </div>
                        <pre style="display:none" id="output"></pre> Timeline Opacity
                        <input type="number" ng-model="tmOpacity" min='1' max='10' ng-change="updateTimeline()" />%
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Share</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- end admin zone -->
        <!-- help modal -->
        <div id="help" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">Oops!</h4>
                    </div>
                    <div class="modal-body">
                        <p>It looks like the Sheet you attempted to open has not been published yet. For your convenience, we've already opened the file you attempted to open in the tab below. Simply follow the steps on the screen to publish the file and then <a ng-click="loadGoogleMapsData(currentlyLoadingKey.key)" data-dismiss="modal" class="btn btn-primary btn-xs">reload the file</a> </p>
                        <b>How to publish a Drive Document</b>
                        <ol>
                            <li>Go to the File menu.</li>
                            <li>Select Publish to the web.</li>
                            <li>Click Publish</li>
                            <a ng-click="loadGoogleMapsData(currentlyLoadingKey.key)" data-dismiss="modal" class="btn btn-primary btn-xs">reload the file</a>
                        </ol>
                        <iframe width="500px" width="100%" ng-src="{{currentlyLoadingKey.url}}"></iframe>
                        <hr><a href="{{currentlyLoadingKey.url}}">Direct link</a>
                        {{currentlyLoadingKey.url}}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- end help modal -->
        <!-- nav bar -->
        <div class="btn-toolbar">
            <div class="btn-group btn-group-justified">
                <a href="#" style="display:none" class="btn btn-default" disabled><i class="fa fa-arrow-left"></i></a>
                <div class="btn-group">
                    <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                      <span class="caret"></span>
  {{dateRange}}
    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#" data-toggle="modal" data-target="#adminCtrl">Load Map</a></li>
                        <li><a ng-click="addMarker.create=true">Add Marker</a></li>
                        <li><a ng-click="addLayer.create=true">Help</a></li>
                    </ul>
                </div>
                <a href="#" style="display:none" class="btn btn-default" disabled><i class="fa fa-arrow-right"></i></a>
            </div>
            <!-- filter selector -->
            <div id="filtersComponent">
                <isteven-multi-select input-model="filters" output-model="selectedFilters" button-label="name" item-label="name" tick-property="ticked" on-close="filterData()" data-toggle="dropdown">
                </isteven-multi-select>
            </div>
            <!-- openlayers map lat="{{ initState.lat }}"  zoom="{ initState.zoom }}" lon="{ initState.log }}" customLayer  custom-layers="false" -->
            <openlayers ol-center="wooster" width="100%" height="100vh" custom-layers="true">
                <!-- load all data layers into map-->
                <ol-layer ng-repeat="item in olLayers" source-type="{{item.dataType}}" source-url="{{item.dataURL}}"></ol-layer>
                <!-- load all data markers into map -->
                <ol-marker ng-repeat="item in olMarkers" message="{{item.name}}" lat="item.lat" lon="item.lon"></ol-marker>
                <!-- dummy new marker -->
                <ol-marker ng-if="addMarker.create" ol-marker-properties="addMarker"></ol-marker>
            </openlayers>
        </div>
        <!-- vis-timeline -->
        <div id="timelineContainer">
            <vis-timeline data="data" width="100%" options="options" events="events"></vis-timeline>
        </div>
        <!-- initalize resizeable element -->
        <script>
            var resizable = new Resizable('timelineContainer', {
                direction: 'top'
            });
        </script>

</body>

</html>
